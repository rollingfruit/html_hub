
帮我按照下面这个开发文档，完成整个HTML的开发。

-----------------——
HTML（单文件可运行）+ CDN 引入的《健身视频姿态识别 + 字幕节奏 + 成片导出》

⸻

0. 项目定位与边界

0.1 产品定位

面向健身内容博主的“成片工作台”：
	•	输入：本地健身视频 + 精确字幕（可免费获得）
	•	处理：浏览器端姿态识别（可选）+ 字幕节奏模板 + 关键帧 freeze/标注
	•	输出：可发布的成片（9:16 / 16:9），默片为主（无配音/BGM）

0.2 非目标（MVP 不做）
	•	不做复杂多轨剪辑（PR/剪映级别）
	•	不做云端存储/账号系统（纯本地）
	•	不保证超长视频（>3min）与 4K/60fps 的流畅导出
	•	不做“全自动纠错”的强医疗级建议（只做内容辅助 + 指标可视化）

0.3 运行环境
	•	单文件 index.html，双击即可运行（本地 file://）
	•	所有依赖用 CDN（姿态库、解析库等）
	•	浏览器：Chrome/Edge 优先；

⸻

1. 核心用户流程（从导入到发布）

1.1 导入
	1.	用户选择本地视频文件（mp4/mov/webm）
	2.	读取视频基本信息：时长、分辨率、帧率（可估算）
	3.	选择输出画幅：
	•	竖屏 9:16（默认）
	•	横屏 16:9

1.2 字幕导入

字幕必带时间段（你已保证来源免费）：
	•	支持格式：
	•	SRT
	•	VTT
	•	JSON（推荐，结构更稳定）
	•	导入后：
	•	解析为统一“字幕段（segment）”结构
	•	做短句化（可选）：自动拆分长句，保证一屏最多 2 行

1.3 姿态识别（可开关）
	•	模式选择：
	•	预览模式：低采样率（10–15fps）或仅在字幕片段跑
	•	导出模式：按设定 fps（24/30）逐帧跑并合成导出
	•	输出：每个采样帧的关键点 + 置信度 + 派生角度

1.4 模板选择（成片风格）

模板是“导演脚本”，驱动：
	•	字幕样式（教学 / 自媒体梗）
	•	骨架显示开关
	•	freeze 时机（基于字幕段末尾或关键事件）
	•	HUD 指标显示（角度/评分条/提示）

1.5 预览与微调
	•	时间轴预览：字幕段可拖拽起止时间
	•	风格调参：字号、行数、底部安全区、关键词高亮、骨架透明度
	•	可选：手动标记“关键瞬间”（freeze 点）

1.6 导出
	•	输出格式：
	•	9:16 / 16:9 视频（webm/mp4 视浏览器支持）
	•	封面图（PNG）
	•	工程文件（JSON，便于下次继续编辑）
	•	导出质量档位：
	•	快速（低码率/低分辨率）
	•	标准（默认）
	•	高清（更慢更大）

⸻

2. 功能模块拆分（单文件内的逻辑分层）

2.1 UI 层（页面分区）

建议 4 个区域（移动端/桌面端自适配）：
	1.	顶栏：导入、模板、导出、工程文件
	2.	左侧：素材区（视频/字幕/模型开关）
	3.	中间：预览区（视频 + canvas 叠加）
	4.	右侧：参数区（字幕样式、骨架、HUD、导出配置）
移动端则折叠成 Tab：

	•	“预览”
	•	“字幕”
	•	“姿态”
	•	“导出”

2.2 数据层（本地存储）
	•	使用 IndexedDB 存：
	•	工程元数据（JSON）
	•	字幕段
	•	姿态结果（可选，只存抽样帧与关键帧，避免爆）
	•	封面图缩略图
	•	大视频文件原则上不强存（避免占空间），只在会话中持有 File 引用；必要时提供“导入后缓存”选项。

2.3 引擎层（核心能力）
	•	字幕引擎：解析/拆句/排版/动画
	•	姿态引擎：抽帧 → 推理 → 平滑 → 指标计算
	•	渲染引擎：每帧合成（视频帧 + 字幕 + 骨架 + HUD）
	•	导出引擎：Canvas → 编码 → 生成文件

⸻

3. 数据结构规范（强烈建议用 JSON 作为内部统一格式）

3.1 工程 Project
	•	projectId
	•	createdAt, updatedAt
	•	videoMeta：时长、宽高、估计 fps、文件名
	•	aspect：9:16 / 16:9
	•	templateId
	•	segments[]：字幕段数组
	•	poseTracks（可选）：姿态数据索引
	•	markers[]：关键点（freeze/标注）
	•	exportProfiles[]：导出配置历史

3.2 字幕段 Segment

每段字幕是“时间 + 文本 + 风格指令”：
	•	id
	•	t0, t1（秒）
	•	text
	•	style（可选覆盖）：
	•	tone: teaching / fun
	•	emphasisWords[]
	•	layout: bottom / top / center
	•	freezeAtEnd: boolean
	•	actions[]（可选）：
	•	showPose: on/off
	•	showHud: kneesAngle / trunkAngle / scoreBar
	•	callout: arrow/circle/text

3.3 姿态帧 PoseFrame（抽样）
	•	t（秒）
	•	keypoints[]：点位 + 置信度
	•	derived：角度/距离等
	•	quality：该帧整体可信度

注意：不要存“每一帧全量”，建议存抽样帧（10–15fps）+ 关键帧。

⸻

4. 字幕系统设计（默片的灵魂）

4.1 排版原则（自媒体优先）
	•	每屏最多 2 行
	•	每行 12–14 个汉字以内（超出自动换行/拆段）
	•	关键字高亮（“膝盖/腰/肩胛/髋”）
	•	底部安全区（避免被平台 UI 遮挡）

4.2 字幕动画（让默片“有节奏”）

提供 3 种基础动画（模板可选）：
	1.	Pop-in：整句弹入
	2.	Word-by-word：逐词出现（节奏最强）
	3.	Emphasis pulse：关键字出现时轻微放大/抖动

4.3 字幕与姿态的联动

字幕段是“导演脚本”：
	•	t0~t1：骨架显示与否
	•	t1-0.3s：是否触发 freeze
	•	关键段落显示 HUD：例如“膝角 92°”

⸻

5. 姿态识别系统设计（浏览器端推理）

5.1 推理模式
	•	预览模式（实时）：
	•	只对字幕段范围推理
	•	或对全片低 fps 抽样推理
	•	导出模式（离线）：
	•	按导出 fps 推理或“推理抽样 + 结果插值”
	•	分段导出（避免内存峰值）

5.2 抽帧策略（极其关键）
	•	输入视频可能 60fps，但姿态分析 10–15fps 足够
	•	对于深蹲/硬拉等动作：关键在最低点/最高点附近
	•	可以在字幕段内做“均匀抽帧”
	•	或做“运动强度检测”（帧间差）提升关键区域采样密度

5.3 质量控制（避免骨架乱跳）
	•	关键点置信度阈值：低于阈值的点不画/淡化
	•	时序平滑：
	•	简单移动平均 / 一阶低通（MVP 足够）
	•	遮挡处理：
	•	当脚踝/膝盖丢点时，暂停该指标的显示（避免误导）

5.4 指标与 HUD（MVP 推荐）

先做最容易解释、最有传播力的：
	•	躯干前倾角（深蹲/硬拉通用）
	•	膝角（深蹲）
	•	膝内扣趋势（深蹲，基于髋-膝-踝相对位置）
显示策略：
	•	只在字幕段内显示
	•	超过阈值时在 freeze 帧打红色提示

⸻

6. 渲染合成（Canvas 合成管线）

6.1 图层顺序

从底到顶：
	1.	视频帧（裁切/缩放到目标画幅）
	2.	骨架（线+点）
	3.	HUD（角度/评分条/轨迹）
	4.	字幕（含动效）
	5.	Hook 标题/CTA（模板控制）

6.2 画幅适配
	•	9:16：视频做居中裁切或加模糊背景填充（两种风格可选）
	•	16:9：保持原比例，字幕底部居中

6.3 Freeze 与标注
	•	Freeze 的触发源：
	•	字幕段末尾（常用）
	•	手动 marker
	•	Freeze 时渲染：
	•	画面停 0.5–1s
	•	标注箭头/圈
	•	大字一句总结

⸻

7. 导出系统（浏览器内生成视频）

7.1 MVP 导出（强推荐）
	•	Canvas 输出为 stream
	•	MediaRecorder 录制
	•	优点：实现简单、兼容性相对好
	•	缺点：码率与清晰度受浏览器影响

7.2 进阶导出（可选）
	•	WebCodecs 编码
	•	优点：质量稳定、可控
	•	缺点：兼容性与实现复杂度更高，需要降级路径

7.3 导出稳定性策略
	•	分段导出：按字幕段或每 10 秒一段，最后拼接（MVP 可不拼，先导单段）
	•	降级选项：
	•	降分辨率（1080x1920 → 720x1280）
	•	降 fps（30 → 24）
	•	关闭骨架或降低骨架刷新率

⸻

8. 模板系统（决定“像不像爆款”）

8.1 模板的组成
	•	字幕样式：字体、阴影、描边、位置、动效
	•	姿态策略：是否全程/仅关键段显示
	•	Freeze 策略：在何处 freeze，多长
	•	HUD 选择：显示哪些指标
	•	文案脚本：Hook/纠错/改法/CTA 的结构

8.2 MVP 提供 3 个模板
	1.	Hook+纠错（最通用）
	2.	评分条（专业感强）
	3.	对比两次 rep（爽感强）

⸻

9. 本地工程文件与复用

9.1 导入导出（工程复盘必备）
	•	导出工程 JSON：字幕、模板、参数、marker、姿态索引
	•	导入工程 JSON：恢复所有编辑状态
	•	导出封面 PNG：自动抓 freeze 帧 + 大标题

9.2 素材库思路（后续）
	•	保存“模板预设”
	•	保存“动作预设”（深蹲/硬拉的指标阈值）

⸻

10. 兼容性与风险清单（上线前自测）

10.1 关键风险
	•	iOS Safari 内存与导出稳定性
	•	跨域视频导致 Canvas 污染（远程 URL 场景）
	•	姿态模型加载失败（CDN 不稳定/网络问题）

10.2 降级策略
	•	无模型：只做字幕成片（默片核心仍成立）
	•	无导出：提供“录屏导出”提示（兜底）
	•	无实时：只做离线片段导出

10.3 推荐的默认限制（保护体验）
	•	视频时长：45–60 秒为默认建议
	•	输入分辨率过高时提示降采样
	•	姿态仅在字幕段启用（默认）
